angular.module("id3Module",["pascalprecht.translate","ngSanitize","localeHelperModule","id3MathModule"]).config(["$translateProvider","localeHelperProvider",function(e,t){e.useLoader("translationLoader");var a=t.getLocale(window.location.pathname);e.preferredLanguage(a),e.useSanitizeValueStrategy("escapeParameters"),window.locale=a}]).factory("translationLoader",["$http","$q","$rootScope",function(e,t,a){return function(r){var o=t.defer(),n={};return n[r.key]?(o.resolve(n[r.key]),o.promise):(e({method:"GET",url:"/locales/"+r.key+".json"}).then(function(e){o.resolve(e),console.log("localeResource:load"),a.$emit("localeResource:load")},o.reject),o.promise)}}]).directive("tree",[function(){return"en"===window.locale?{templateUrl:"/templates/en/stats.html",scope:{stats:"="},link:function(e,t,a){}}:{templateUrl:"/templates/stats.html",scope:{stats:"="},link:function(e,t,a){}}}]).controller("ID3Ctrl",["$scope","id3","$filter","$q",function(e,t,a,r){function o(e,a){for(var r=0,o=0;o<e.length;o++){r++;var n=e[o];"undefined"==typeof a["决策"].set[n["决策"]]&&(a["决策"].set[n["决策"]]=0),a["决策"].set[n["决策"]]++}a["决策"].sum=r,a["决策"].entropy=t.entropy(a["决策"])}function n(e,a){var r={"决策":{set:{}}};o(e,r),r.range=t.getAttributesRanges(e,a),r.categories=t.divideRanges(r.range),r.subCategories={},r.subGains={};var n=-(1/0);for(var i in r.range)"决策"!==i&&(r.subCategories[i]=t.subDivide(e,i,r.categories[i]),r.subGains[i]=t.gain(r["决策"],r.subCategories[i]),r.subGains[i]>n&&(n=r.subGains[i],r.maxGainAttr=i));return r}function i(e,t,a,r,o,n){Handsontable.TextCell.renderer.apply(this,arguments),console.log("value = ",o),String(o).startsWith("=")&&(t.style.background="red")}e.testData=location.search.indexOf("enjoySports")>=0?[{Sky:"Sunny",AirTemp:"Warm",Humidity:"Normal",Wind:"Strong",Water:"Warm",Forecast:"Same","决策":"Yes"},{Sky:"Sunny",AirTemp:"Warm",Humidity:"High",Wind:"Strong",Water:"Warm",Forecast:"Same","决策":"Yes"},{Sky:"Rainy",AirTemp:"Cold",Humidity:"High",Wind:"Strong",Water:"Warm",Forecast:"Change","决策":"No"},{Sky:"Sunny",AirTemp:"Warm",Humidity:"High",Wind:"Strong",Water:"Cool",Forecast:"Change","决策":"Yes"},{Sky:"Sunny",AirTemp:"Warm",Humidity:"Normal",Wind:"Weak",Water:"Warm",Forecast:"Same","决策":"No"}]:location.search.indexOf("weather")>=0?[{"天气":"晴朗","温度":"炎热","湿度":"高","风":"无","决策":"否"},{"天气":"晴朗","温度":"炎热","湿度":"高","风":"有","决策":"否"},{"天气":"多云","温度":"炎热","湿度":"高","风":"无","决策":"是"},{"天气":"有雨","温度":"温暖","湿度":"高","风":"无","决策":"是"},{"天气":"有雨","温度":"凉爽","湿度":"中","风":"无","决策":"是"},{"天气":"有雨","温度":"凉爽","湿度":"中","风":"有","决策":"否"},{"天气":"多云","温度":"凉爽","湿度":"中","风":"有","决策":"是"},{"天气":"晴朗","温度":"温暖","湿度":"高","风":"无","决策":"否"},{"天气":"晴朗","温度":"凉爽","湿度":"中","风":"无","决策":"是"},{"天气":"有雨","温度":"温暖","湿度":"中","风":"无","决策":"是"},{"天气":"晴朗","温度":"温暖","湿度":"中","风":"有","决策":"是"},{"天气":"多云","温度":"温暖","湿度":"高","风":"有","决策":"是"},{"天气":"多云","温度":"炎热","湿度":"中","风":"无","决策":"是"},{"天气":"有雨","温度":"温暖","湿度":"高","风":"有","决策":"否"}]:[{GMAT:650,GPA:2.75,"GMAT 定量评分":35,"决策":"No"},{GMAT:580,GPA:3.5,"GMAT 定量评分":70,"决策":"No"},{GMAT:600,GPA:3.5,"GMAT 定量评分":75,"决策":"Yes"},{GMAT:450,GPA:2.95,"GMAT 定量评分":80,"决策":"No"},{GMAT:700,GPA:3.25,"GMAT 定量评分":90,"决策":"Yes"},{GMAT:590,GPA:3.5,"GMAT 定量评分":80,"决策":"Yes"},{GMAT:400,GPA:3.85,"GMAT 定量评分":45,"决策":"No"},{GMAT:640,GPA:3.5,"GMAT 定量评分":75,"决策":"Yes"},{GMAT:540,GPA:3,"GMAT 定量评分":60,"决策":"?"},{GMAT:690,GPA:2.85,"GMAT 定量评分":80,"决策":"?"},{GMAT:490,GPA:4,"GMAT 定量评分":65,"决策":"?"}],e.subDivide=t.subDivide,e.gain=t.gain,e.stats={},e.$watch("testData",function(t,a){console.log("testData updated"),e.stats=n(e.testData),e.id3()}),e.stats.showSplitDetail={};var s=go.GraphObject.make,l=s(go.Diagram,"myDiagramDiv",{initialAutoScale:go.Diagram.UniformToFill,layout:s(go.TreeLayout,{comparer:go.LayoutVertex.smartComparer})});l.nodeTemplate=s(go.Node,"Auto",s(go.Shape,"RoundedRectangle",{strokeWidth:0,fill:"white"},new go.Binding("fill","color")),s(go.TextBlock,{margin:8},new go.Binding("text","key"))),l.model=new go.GraphLinksModel([{key:"Alpha",color:"lightblue"},{key:"Beta",color:"orange"},{key:"Gamma",color:"lightgreen"},{key:"Delta",color:"pink"}],[{from:"Alpha",to:"Beta"},{from:"Alpha",to:"Gamma"},{from:"Beta",to:"Beta"},{from:"Gamma",to:"Delta"},{from:"Delta",to:"Alpha"}]),e.id3=function(){var t=[],a=[],r=e.stats;e.stats.showSplitDetail=e.stats.showSplitDetail||{},e.stats.showSplitDetail[r.maxGainAttr]=!0,t.push({key:"决策"}),t.push({key:r.maxGainAttr}),a.push({from:t[t.length-2].key,to:r.maxGainAttr});for(var o=[r],i=0;o.length&&i<1e4;){i++;var s=o.shift();if(!(s["决策"].entropy<=0))for(var u in s.subCategories[s.maxGainAttr]){var c=s.subCategories[s.maxGainAttr][u];if(t.push({key:u}),a.push({from:s.maxGainAttr,to:u}),c.entropy<=0){var m=Object.entries(c.set)[0][0];t.filter(function(e){return e.key===m}).length<=0&&t.push({key:m}),a.push({from:u,to:m})}else{var d=c.rawData,g=n(d,s.maxGainAttr);c.stats=g,t.push({key:g.maxGainAttr}),a.push({from:u,to:g.maxGainAttr}),g["决策"].entropy>0&&Object.values(g.subGains).reduce(function(e,t){return e+t},0)>0&&o.push(g)}}}l.model=new go.GraphLinksModel(t,a)},Handsontable.renderers.registerRenderer("negativeValueRenderer",i);var u=document.getElementById("data-table");new Handsontable(u,{data:t.mapObjectArrayToArrayArray(e.testData),colHeaders:!0,rowHeaders:!0,manualColumnResize:!0,formulas:!0,cells:function(e,t,a){const r={};return r.renderer="negativeValueRenderer",r},contextMenu:{callback:function(){e.testData=t.mapArrayArrayToObjectArray(this.getData().filter(function(e){return e.reduce(function(e,t){return e&&null!==t},!0)})),e.$apply()}},autoWrapRow:!0,Controller:!0,minSpareRows:1,enterBeginsEditing:!1,beforeChange:function(e,t){},afterChange:function(){e.testData=t.mapArrayArrayToObjectArray(this.getData().filter(function(e){return e.reduce(function(e,t){return e&&null!==t},!0)}))}})}]);